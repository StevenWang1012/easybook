<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amber Flow é ç´„ç³»çµ± (Demo)</title>
    
    <!-- å¼•å…¥ Tailwind CSS (ç¾åŒ–æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM (æ ¸å¿ƒå¼•æ“) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- å¼•å…¥ Babel (è®“ç€è¦½å™¨çœ‹ä¸æ‡‚çš„ JSX è½‰æˆçœ‹å¾—æ‡‚çš„ JS) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- å¼•å…¥åœ–æ¨™åº« (Lucide Icons) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- â˜… å¼•å…¥ Supabase Client (èˆ‡è³‡æ–™åº«æºé€šçš„æ©‹æ¨‘) -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        @keyframes fade-in-up {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.5s ease-out forwards; }
        
        /* è¼‰å…¥ä¸­çš„è½‰åœˆåœˆå‹•ç•« */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- é€™æ˜¯ React ç¨‹å¼æ›è¼‰çš„æ ¹ç›®éŒ„ -->
    <div id="root"></div>

    <!-- é€™è£¡æ˜¯ React ç¨‹å¼ç¢¼é‚è¼¯ -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // â˜… è¨­å®š Supabase é€£ç·šè³‡è¨Š (Amber Flow)
        const supabaseUrl = 'https://kwvbhzjzysmivafsvwng.supabase.co';
        const supabaseKey = 'sb_publishable_7RUbenk2kXNDmvuo1XtHbQ_m0RjXuZr'; 
        
        // å»ºç«‹é€£ç·šå¯¦é«” (ä½¿ç”¨ window.supabase ç¢ºä¿è®€å–åˆ°å…¨åŸŸè®Šæ•¸)
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        // â˜… å‹•æ…‹ç”Ÿæˆ 08:00 ~ 21:00 çš„ 30 åˆ†é˜é–“éš”æ™‚æ®µ
        const generateTimeSlots = () => {
            const slots = [];
            let startHour = 8;
            let endHour = 21; 

            for (let h = startHour; h <= endHour; h++) {
                slots.push(`${h.toString().padStart(2, '0')}:00`);
                if (h < endHour) {
                    slots.push(`${h.toString().padStart(2, '0')}:30`);
                }
            }
            return slots;
        };

        const TIME_SLOTS = generateTimeSlots();

        // --- ä¸»ç¨‹å¼å…ƒä»¶ ---
        function BookingApp() {
            // --- ç‹€æ…‹ç®¡ç† ---
            const [step, setStep] = useState(1);
            
            // è³‡æ–™ç‹€æ…‹ (å¾ DB æŠ“å›ä¾†å¾Œæ”¾åœ¨é€™è£¡)
            const [storeInfo, setStoreInfo] = useState(null);
            const [services, setServices] = useState([]);
            const [staffList, setStaffList] = useState([]);
            const [loading, setLoading] = useState(true); // è¼‰å…¥ä¸­ç‹€æ…‹
            
            // é¸æ“‡ç‹€æ…‹
            const [selectedService, setSelectedService] = useState(null);
            const [selectedStaff, setSelectedStaff] = useState(null);
            const [selectedTime, setSelectedTime] = useState(null);
            // â˜… æ–°å¢ï¼šé¸æ“‡çš„æ—¥æœŸï¼Œé è¨­ç‚ºä»Šæ—¥
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            
            // â˜… æ–°å¢ï¼šå·²ä½”ç”¨çš„æ™‚æ®µ (å¾ DB æŠ“)
            const [bookedSlots, setBookedSlots] = useState([]);
            const [isCheckingSlots, setIsCheckingSlots] = useState(false);

            // â˜… æ–°å¢ï¼šæ³¨æ„äº‹é … Modal é–‹é—œ
            const [showInfoModal, setShowInfoModal] = useState(false);

            const [customerInfo, setCustomerInfo] = useState({ name: '', phone: '' });
            const [error, setError] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false); // é€å‡ºä¸­ç‹€æ…‹

            // --- â˜… useEffect: ç•«é¢è¼‰å…¥æ™‚ï¼Œå» Supabase æŠ“è³‡æ–™ ---
            useEffect(() => {
                async function fetchData() {
                    try {
                        setLoading(true);
                        
                        // 1. æŠ“å–åº—å®¶è³‡è¨Š
                        const { data: stores, error: storeError } = await supabaseClient.from('stores').select('*').limit(1);
                        if (storeError) throw storeError;
                        
                        if (stores && stores.length > 0) {
                            setStoreInfo({
                                ...stores[0],
                                // è‹¥ DB æ²’é€™äº›æ¬„ä½ï¼Œå‰ç«¯è£œä¸Šé è¨­å€¼ä»¥é˜²è¬ä¸€
                                description: stores[0].description || "æ‰¾å›èº«é«”çš„æµå‹•èˆ‡å¹³è¡¡ï¼Œå°ˆå±¬æ–¼æ‚¨çš„èº«å¿ƒä¿®å¾©æ™‚å…‰ã€‚",
                                address: stores[0].address || "å°åŒ—å¸‚ä¸­å±±å€å—äº¬è¥¿è·¯ 88 è™Ÿ",
                                rating: 5.0,
                                lineUrl: stores[0].line_url 
                            });
                        }

                        // 2. æŠ“å–æœå‹™åˆ—è¡¨ (éæ¿¾æ‰å·²åˆªé™¤çš„)
                        const { data: servicesData, error: serviceError } = await supabaseClient.from('services').select('*');
                        if (serviceError) throw serviceError;
                        if (servicesData) setServices(servicesData.filter(i => !i.deleted_at));

                        // 3. æŠ“å–äººå“¡åˆ—è¡¨ (éæ¿¾æ‰å·²åˆªé™¤çš„)
                        const { data: staffData, error: staffError } = await supabaseClient.from('staff').select('*').order('rating', { ascending: false });
                        if (staffError) throw staffError;
                        if (staffData) setStaffList(staffData.filter(i => !i.deleted_at));

                    } catch (err) {
                        console.error("è³‡æ–™è®€å–å¤±æ•—:", err);
                        alert("é€£ç·šç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
                    } finally {
                        setLoading(false);
                    }
                }
                
                fetchData();
            }, []);

            // â˜… ç•¶é€²å…¥ã€Œé¸æ“‡æ™‚é–“ã€æ­¥é©Ÿæ™‚ï¼Œæˆ–è€…åˆ‡æ›æ—¥æœŸæ™‚ï¼Œå»æŠ“å–è©²æ•™ç·´çš„è¡Œç¨‹
            useEffect(() => {
                if (step === 3 && selectedStaff) {
                    fetchAvailability();
                }
            }, [step, selectedDate, selectedStaff]);

            async function fetchAvailability() {
                setIsCheckingSlots(true);
                // æŠ“å–è©²æ•™ç·´ã€è©²æ—¥æœŸçš„æ‰€æœ‰è¨‚å–® (åŒ…å« confirmed å’Œ blocked)
                const query = supabaseClient
                    .from('bookings')
                    .select('booking_time')
                    .eq('booking_date', selectedDate)
                    .neq('status', 'cancelled'); 

                // å¦‚æœæœ‰æŒ‡å®šæ•™ç·´æ‰æŸ¥è©²æ•™ç·´ï¼Œè‹¥ä¸æŒ‡å®šå‰‡è¦–ç‚ºå…¨åº— (MVP å…ˆç°¡åŒ–é‚è¼¯)
                if (!selectedStaff.isAny) {
                    query.eq('staff_name', selectedStaff.name);
                }

                const { data, error } = await query;
                if (data) {
                    const times = data.map(b => b.booking_time);
                    setBookedSlots(times);
                }
                setIsCheckingSlots(false);
            }

            // --- è™•ç†å‡½å¼ ---
            const handleServiceSelect = (service) => { setSelectedService(service); setStep(2); };
            const handleStaffSelect = (staff) => { setSelectedStaff(staff); setStep(3); };
            const handleTimeSelect = (time) => { setSelectedTime(time); setStep(4); };

            // --- â˜… ç¢ºèªé ç´„ä¸¦å¯«å…¥è³‡æ–™åº« ---
            const handleConfirm = async () => {
                // é©—è­‰ï¼šç¢ºä¿è¼¸å…¥çš„æ˜¯ 8 ä½æ•¸å­— (09 å·²ç¶“å›ºå®šäº†)
                const phoneSuffixRegex = /^\d{8}$/;
                if (!phoneSuffixRegex.test(customerInfo.phone)) {
                    setError('è«‹è¼¸å…¥å®Œæ•´çš„æ‰‹æ©Ÿè™Ÿç¢¼ (å¾Œ 8 ç¢¼)');
                    return;
                }

                // çµ„åˆå®Œæ•´è™Ÿç¢¼ï¼š09 + ç”¨æˆ¶è¼¸å…¥çš„ 8 ç¢¼
                const fullPhoneNumber = '09' + customerInfo.phone;

                setIsSubmitting(true);
                try {
                    // å¯«å…¥ Supabase 'bookings' è¡¨
                    const { error: insertError } = await supabaseClient.from('bookings').insert([
                        {
                            store_id: storeInfo.id,
                            service_name: selectedService.name,
                            staff_name: selectedStaff.name,
                            booking_date: selectedDate, // ä½¿ç”¨é¸æ“‡çš„æ—¥æœŸ
                            booking_time: selectedTime,
                            customer_name: customerInfo.name,
                            customer_phone: fullPhoneNumber,
                            status: 'confirmed' // é è¨­ç‹€æ…‹
                        }
                    ]);

                    if (insertError) throw insertError;

                    // æˆåŠŸï¼
                    setStep(5);
                } catch (err) {
                    console.error("é ç´„å¯«å…¥å¤±æ•—:", err);
                    alert("é ç´„å¤±æ•—ï¼Œè©²æ™‚æ®µå¯èƒ½å‰›å‰›è¢«æ¶èµ°äº†ï¼Œè«‹é‡è©¦ï¼");
                } finally {
                    setIsSubmitting(false);
                }
            };

            // --- åœ–æ¨™çµ„ä»¶ ---
            const Icon = ({ name, size = 20, className = "" }) => {
                const ref = useRef(null);
                useEffect(() => {
                    if (!ref.current || !window.lucide) return;
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    i.setAttribute('width', size);
                    i.setAttribute('height', size);
                    if (className) i.setAttribute('class', className);
                    ref.current.innerHTML = '';
                    ref.current.appendChild(i);
                    window.lucide.createIcons({ root: ref.current });
                }, [name, size, className]);
                return <span ref={ref} className="inline-flex items-center justify-center"></span>;
            };

            // --- è¼‰å…¥ä¸­ç•«é¢ ---
            if (loading) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50">
                        <div className="loader mb-4"></div>
                        <p className="text-slate-500">æ­£åœ¨å–šé†’ Amber çš„è³‡æ–™åº«...</p>
                    </div>
                );
            }

            if (!storeInfo) return <div className="text-center p-10">æ‰¾ä¸åˆ°åº—å®¶è³‡æ–™ï¼Œè«‹ç¢ºèªè³‡æ–™åº«å·²å»ºç«‹ã€‚</div>;

            return (
                <div className="min-h-screen bg-gradient-to-br from-stone-50 to-emerald-50 flex justify-center p-4 relative">
                    <div className="w-full max-w-md bg-white rounded-[32px] shadow-2xl flex flex-col overflow-hidden relative border border-white/50 h-[85vh]">
                        
                        {/* é ‚éƒ¨å°è¦½ */}
                        <header className="bg-white/80 backdrop-blur-md p-4 border-b border-stone-100 flex items-center sticky top-0 z-20">
                            {step > 1 && step < 5 && (
                                <button onClick={() => setStep(step - 1)} className="mr-2 p-2 rounded-full hover:bg-stone-100 transition-colors">
                                    <Icon name="chevron-left" />
                                </button>
                            )}
                            <div className="flex-1 text-center font-bold text-stone-700">
                                {step === 1 ? "é ç´„èª²ç¨‹" : step === 2 ? "é¸æ“‡æŒ‡å°è€å¸«" : step === 3 ? "é¸æ“‡æ™‚æ®µ" : step === 4 ? "ç¢ºèªè³‡æ–™" : "é ç´„å®Œæˆ"}
                            </div>
                            {step > 1 && step < 5 && <div className="w-10"></div>}
                        </header>

                        {/* é€²åº¦æ¢ */}
                        {step < 5 && (
                            <div className="w-full bg-stone-100 h-1">
                                <div className="bg-emerald-500 h-1 transition-all duration-500" style={{ width: `${(step / 4) * 100}%` }}></div>
                            </div>
                        )}

                        <main className="flex-1 p-5 overflow-y-auto custom-scrollbar">
                            
                            {/* STEP 1: æœå‹™ (å¾ services ç‹€æ…‹è®€å–) */}
                            {step === 1 && (
                                <div className="space-y-6 animate-fade-in-up">
                                    {/* â˜… åº—å®¶ Header (æ¨™é¡Œ + æè¿° + åœ°é» + Info) */}
                                    <div className="text-center py-4 relative">
                                        <div className="flex items-center justify-center mb-2">
                                            <h1 className="text-2xl font-bold text-stone-800">{storeInfo.name}</h1>
                                            {/* æ³¨æ„äº‹é …æŒ‰éˆ• */}
                                            <button 
                                                onClick={() => setShowInfoModal(true)}
                                                className="ml-2 text-stone-400 hover:text-emerald-600 transition-colors"
                                            >
                                                <Icon name="info" size={20} />
                                            </button>
                                        </div>
                                        <p className="text-sm text-stone-500 mt-1 tracking-wide px-4 whitespace-pre-wrap">{storeInfo.description}</p>
                                        {/* åœ°é»é¡¯ç¤º */}
                                        <div className="flex items-center justify-center mt-3 text-xs text-stone-400">
                                            <Icon name="map-pin" size={14} className="mr-1 text-emerald-500" />
                                            {storeInfo.address}
                                        </div>
                                    </div>

                                    <div className="space-y-4">
                                        {services.map(service => (
                                            <div key={service.id} onClick={() => handleServiceSelect(service)} 
                                                className="bg-white border border-stone-100 rounded-2xl p-5 hover:border-emerald-400 hover:shadow-lg cursor-pointer transition-all active:scale-95 group">
                                                <div className="flex justify-between">
                                                    <div>
                                                        <h3 className="font-bold text-lg text-stone-800 group-hover:text-emerald-700">{service.name}</h3>
                                                        <p className="text-xs text-stone-400 mt-1">{service.description}</p>
                                                        <div className="flex items-center text-xs text-stone-400 mt-2 font-medium">
                                                            <span className="mr-1">ğŸ•’</span> {service.duration} åˆ†é˜
                                                        </div>
                                                    </div>
                                                    <span className="text-lg font-bold text-emerald-600 font-mono">${service.price}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* STEP 2: äººå“¡ (å¾ staffList ç‹€æ…‹è®€å–) */}
                            {step === 2 && (
                                <div className="space-y-4 animate-fade-in-up">
                                    <div className="bg-emerald-50 p-3 rounded-xl text-sm text-emerald-800 border border-emerald-100 flex justify-between">
                                        <span>èª²ç¨‹ï¼š{selectedService.name}</span>
                                        <span className="font-bold">${selectedService.price}</span>
                                    </div>
                                    <div onClick={() => handleStaffSelect({ id: 'any', name: 'ä¸æŒ‡å®šè€å¸«', avatar: '', isAny: true })}
                                        className="border border-dashed border-stone-300 rounded-2xl p-4 flex items-center hover:bg-emerald-50 cursor-pointer">
                                        <div className="w-12 h-12 bg-stone-100 rounded-full flex items-center justify-center mr-4 text-xl">ğŸ§˜</div>
                                        <div>
                                            <h3 className="font-bold text-stone-700">ä¸æŒ‡å®š (æœ€å¿«å¯ç´„)</h3>
                                            <p className="text-xs text-stone-400">ç”±ç³»çµ±å®‰æ’åˆé©æ•™ç·´</p>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        {staffList.map(staff => (
                                            <div key={staff.id} onClick={() => handleStaffSelect(staff)}
                                                className="border border-stone-100 rounded-2xl p-4 flex flex-col items-center hover:border-emerald-500 hover:shadow-md cursor-pointer bg-white group">
                                                <img src={staff.avatar} className="w-16 h-16 rounded-full mb-2 bg-stone-50 group-hover:scale-105 transition-transform object-cover" />
                                                <h3 className="font-bold text-stone-700">{staff.name}</h3>
                                                <span className="text-[10px] bg-stone-100 text-stone-500 px-2 py-1 rounded mt-1">{staff.title}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* STEP 3: æ™‚é–“ (å‹•æ…‹æ™‚æ®µ) */}
                            {step === 3 && (
                                <div className="animate-fade-in-up">
                                    <div className="flex space-x-2 mb-6 text-xs">
                                        <span className="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full">{selectedService.name}</span>
                                        <span className="bg-stone-100 text-stone-600 px-3 py-1 rounded-full">{selectedStaff.name}</span>
                                    </div>
                                    
                                    {/* æ—¥æœŸé¸æ“‡å™¨ */}
                                    <div className="mb-6">
                                        <label className="block text-xs font-bold text-stone-400 mb-2 uppercase">é ç´„æ—¥æœŸ</label>
                                        <input 
                                            type="date" 
                                            value={selectedDate} 
                                            onChange={e => setSelectedDate(e.target.value)}
                                            className="w-full p-3 bg-white border border-stone-200 rounded-xl font-bold text-stone-700"
                                        />
                                    </div>

                                    <h3 className="font-bold mb-4 flex items-center text-stone-700">
                                        <Icon name="calendar" size={16} className="mr-2"/> 
                                        é¸æ“‡æ™‚æ®µ
                                        {isCheckingSlots && <span className="ml-2 text-xs font-normal text-slate-400">æŸ¥è©¢ä¸­...</span>}
                                    </h3>
                                    
                                    {/* 4 æ¬„æ’ç‰ˆ */}
                                    <div className="grid grid-cols-4 gap-2">
                                        {TIME_SLOTS.map(time => {
                                            // æª¢æŸ¥æ˜¯å¦è¢«ä½”ç”¨
                                            const isTaken = bookedSlots.includes(time);
                                            
                                            return (
                                                <button 
                                                    key={time} 
                                                    onClick={() => !isTaken && handleTimeSelect(time)}
                                                    disabled={isTaken}
                                                    className={`py-2 px-1 border rounded-lg text-sm font-medium transition active:scale-95 flex flex-col items-center justify-center
                                                        ${isTaken 
                                                            ? 'bg-stone-100 text-stone-300 border-stone-100 cursor-not-allowed' 
                                                            : 'bg-white hover:bg-emerald-600 hover:text-white hover:border-emerald-600 text-stone-600 border-stone-200'}`}
                                                >
                                                    {time}
                                                    {/* å¦‚æœé¡æ»¿ï¼Œé¡¯ç¤ºå°å­— */}
                                                    {isTaken && <span className="text-[9px] font-normal">å·²é¡æ»¿</span>}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {/* STEP 4: è³‡æ–™ */}
                            {step === 4 && (
                                <div className="space-y-6 animate-fade-in-up">
                                    <div className="bg-white border border-stone-100 shadow-lg rounded-2xl overflow-hidden">
                                        <div className="bg-emerald-600 p-3 text-white font-bold text-center">é ç´„ç¢ºèª</div>
                                        <div className="p-5 space-y-3 text-sm">
                                            <div className="flex justify-between"><span className="text-stone-400">èª²ç¨‹</span><span className="font-medium text-stone-700">{selectedService.name}</span></div>
                                            <div className="flex justify-between"><span className="text-stone-400">è€å¸«</span><span className="font-medium text-stone-700">{selectedStaff.name}</span></div>
                                            <div className="flex justify-between"><span className="text-stone-400">æ™‚é–“</span><span className="font-bold text-emerald-600">{selectedDate} {selectedTime}</span></div>
                                            <div className="pt-3 border-t border-stone-100 flex justify-between items-center">
                                                <span className="text-stone-400">è²»ç”¨</span>
                                                <span className="text-xl font-bold text-stone-800">${selectedService.price}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold text-stone-400 mb-1 ml-1 uppercase">å§“å</label>
                                            <input type="text" placeholder="æ‚¨çš„ç¨±å‘¼" value={customerInfo.name} onChange={(e) => setCustomerInfo({...customerInfo, name: e.target.value})}
                                                className="w-full p-3 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none"/>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-stone-400 mb-1 ml-1 uppercase">æ‰‹æ©Ÿ</label>
                                            <div className="relative">
                                                {/* UI ä¿®æ”¹ï¼šå·¦å´å›ºå®šé¡¯ç¤º 09 */}
                                                <div className="absolute left-0 top-0 bottom-0 flex items-center pl-4 pointer-events-none">
                                                    <span className="text-stone-500 font-bold border-r border-stone-300 pr-2 mr-2">09</span>
                                                </div>
                                                <input 
                                                    type="tel" 
                                                    maxLength="8"
                                                    value={customerInfo.phone} 
                                                    onChange={(e) => { 
                                                        // é‚è¼¯ä¿®æ”¹ï¼šåªèƒ½è¼¸å…¥æ•¸å­—
                                                        const val = e.target.value.replace(/\D/g, '');
                                                        setCustomerInfo({...customerInfo, phone: val}); 
                                                        setError(''); 
                                                    }}
                                                    className={`w-full pl-16 pr-4 py-3 bg-stone-50 border rounded-xl focus:ring-2 outline-none ${error ? 'border-red-500 bg-red-50' : 'border-stone-200 focus:ring-emerald-500'}`}
                                                />
                                            </div>
                                            {error && <p className="text-red-500 text-xs mt-1 ml-1">{error}</p>}
                                        </div>
                                    </div>
                                    <button 
                                        onClick={handleConfirm} 
                                        disabled={isSubmitting}
                                        className={`w-full text-white py-4 rounded-xl font-bold text-lg shadow-xl active:scale-95 transition-all ${isSubmitting ? 'bg-stone-400 cursor-not-allowed' : 'bg-stone-800 hover:bg-stone-900'}`}
                                    >
                                        {isSubmitting ? 'è™•ç†ä¸­...' : 'ç¢ºèªé ç´„'}
                                    </button>
                                </div>
                            )}

                            {/* STEP 5: å®Œæˆ */}
                            {step === 5 && (
                                <div className="text-center pt-8 animate-fade-in-up">
                                    <div className="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <Icon name="check" size={40} className="text-emerald-600" />
                                    </div>
                                    <h2 className="text-2xl font-bold text-stone-800 mb-2">é ç´„æˆåŠŸï¼</h2>
                                    <p className="text-stone-500 text-sm mb-8">æ„Ÿè¬æ‚¨çš„é ç´„ï¼ŒæœŸå¾…èˆ‡æ‚¨åœ¨å¢Šä¸Šç›¸è¦‹ã€‚</p>

                                    <div className="bg-stone-50 p-6 rounded-2xl text-left mb-6 border border-stone-200">
                                        <div className="flex items-center mb-4">
                                            <Icon name="calendar" className="mr-3 text-emerald-500"/>
                                            <div>
                                                <h3 className="font-bold text-stone-800">{selectedDate}</h3>
                                                <p className="text-emerald-600 font-bold">{selectedTime}</p>
                                            </div>
                                        </div>
                                        <div className="text-sm text-stone-500 space-y-1 pl-9 border-l-2 border-stone-200 ml-2">
                                            <p>èª²ç¨‹ï¼š{selectedService.name}</p>
                                            <p>è€å¸«ï¼š{selectedStaff.name}</p>
                                            {/* UI ä¿®æ”¹ï¼šé¡¯ç¤ºå®Œæ•´è™Ÿç¢¼ */}
                                            <p>é›»è©±ï¼š09{customerInfo.phone}</p>
                                        </div>
                                    </div>

                                    <a href={storeInfo.lineUrl} target="_blank" className="block w-full bg-[#06c755] text-white py-3 rounded-xl font-bold hover:bg-[#05b34c] transition flex items-center justify-center shadow-lg shadow-green-500/20">
                                        <span className="mr-2 text-xl">ğŸ’¬</span> åŠ å…¥ LINE æ¥æ”¶æé†’
                                    </a>
                                    <button onClick={() => window.location.reload()} className="block w-full text-stone-400 py-3 text-sm mt-2 hover:text-stone-600">è¿”å›é¦–é </button>
                                </div>
                            )}
                        </main>
                        
                        {/* â˜… é–‹ç™¼è€…æ¨¡å¼ï¼šå•†å®¶å¾Œå°å…¥å£æŒ‰éˆ• (æ”¾åœ¨ UI å…§éƒ¨çš„å³ä¸‹è§’) */}
                        <a href="admin.html" className="absolute bottom-4 right-4 bg-slate-800/90 text-white px-3 py-2 rounded-lg shadow-lg hover:bg-emerald-600 transition-all z-50 backdrop-blur-sm flex items-center text-xs font-bold" title="å‰å¾€å•†å®¶å¾Œå°">
                            <Icon name="settings" size={14} className="mr-1" />
                            é–‹ç™¼æ¨¡å¼
                        </a>

                        {/* â˜… æ³¨æ„äº‹é … Modal (å½ˆè·³è¦–çª—) */}
                        {showInfoModal && (
                            <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-6 backdrop-blur-sm animate-fade-in-up">
                                <div className="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm relative">
                                    <button onClick={() => setShowInfoModal(false)} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                                        <Icon name="x" size={24} />
                                    </button>
                                    <h3 className="text-xl font-bold text-stone-800 mb-4 flex items-center">
                                        <Icon name="info" className="mr-2 text-emerald-500" />
                                        èª²ç¨‹é ç´„é ˆçŸ¥
                                    </h3>
                                    <div className="text-sm text-stone-600 space-y-3 leading-relaxed whitespace-pre-wrap">
                                        {storeInfo.terms || `æ­¡è¿ä¾†åˆ° Amber Flowï¼ç‚ºäº†ç¶­è­·èª²ç¨‹å“è³ªï¼Œè«‹æ‚¨ç•™æ„ä»¥ä¸‹äº‹é …ï¼š
                                        
1. è«‹è‘—è¼•ä¾¿é‹å‹•æœè£ï¼Œä¸¦è‡ªå‚™æ¯›å·¾èˆ‡æ°´å£ºã€‚
2. è«‹æå‰ 5-10 åˆ†é˜ æŠµé”æ•™å®¤ï¼Œé€²è¡Œæ›´è¡£èˆ‡æš–èº«æº–å‚™ã€‚
3. ä¸Šèª²æœŸé–“è«‹å°‡æ‰‹æ©Ÿèª¿æ•´ç‚ºéœéŸ³ï¼Œå°ˆæ³¨æ–¼ç•¶ä¸‹ã€‚
4. è‹¥æœ‰å¿ƒè¡€ç®¡ç–¾ç—…ã€æ‡·å­•æˆ–èˆŠå‚·ï¼Œè«‹å‹™å¿…æ–¼èª²å‰å‘ŠçŸ¥è€å¸«ã€‚

å–æ¶ˆæ”¿ç­–ï¼š
å¦‚éœ€å–æ¶ˆæˆ–æ›´æ”¹é ç´„ï¼Œè«‹æ–¼èª²ç¨‹é–‹å§‹å‰ 24 å°æ™‚ é€é LINE æˆ–ç³»çµ±å‘ŠçŸ¥ï¼Œä»¥å…å½±éŸ¿æ‚¨æœªä¾†çš„é ç´„æ¬Šç›Šã€‚`}
                                    </div>
                                    <button onClick={() => setShowInfoModal(false)} className="w-full mt-6 bg-stone-800 text-white py-3 rounded-xl font-bold hover:bg-stone-900 transition">
                                        æˆ‘äº†è§£äº†
                                    </button>
                                </div>
                            </div>
                        )}

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BookingApp />);
    </script>
</body>
</html>
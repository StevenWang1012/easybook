# EasyBook 變數命名審查與重構建議 (Code Review)

## 1. URL 參數的歧義性 (Ambiguity of URL Params)

**現狀問題**： 目前的 Query Parameter `?id=` 在不同頁面代表完全不同的實體，容易造成開發混淆或錯誤連結。

| **頁面** | **?id= 代表的意義** | **範例** |
| --- | --- | --- |
| `booking.html` | **Store ID (店家 ID)** | `booking.html?id=store_123` |
| `staff.html` | **Staff ID (員工 ID)** | `staff.html?id=staff_456` |
| `admin.html` | (無/不使用) | 依賴 Auth Token |

**建議統一方案**： 採用 **「顯式命名 (Explicit Naming)」**，廢棄通用的 `id`。

- `booking.html?store_id=...`
- `staff.html?staff_id=...`

## 2. 老師登入碼的多重命名 (Inconsistent Naming)

**現狀問題**： 同一個「4-6碼數字密碼」的概念，在不同層級有 4 種不同的變數名稱。

| **層級** | **變數名稱** | **所在位置** |
| --- | --- | --- |
| **資料庫 (DB)** | `login_code` | `public.staff` table |
| **老師端 (Frontend)** | `passcode` | `staff.html` (React State) |
| **RPC 參數** | `p_staff_code` | `staff_update_booking_status` |
| **首頁設定 (Config)** | `staffCode` | `index.html` (DEMO_CONFIG) |

**建議統一方案**： 統一使用 **`login_code`** (或駝峰式 `loginCode`)，消除認知落差。

## 3. 日期與時間的欄位混用

**現狀問題**： 在預約物件與表單中，日期與時間的命名搖擺不定。

| **情境** | **變數名稱** |
| --- | --- |
| **資料庫 (Bookings)** | `booking_date`, `booking_time` |
| **表單 State** | `date`, `time` (例如 `WalkInBooking` 组件) |
| **行事曆 Slot** | `time` (代表 `HH:MM`) |

**建議統一方案**：

- **資料庫與 API 回傳**：維持 `booking_date`, `booking_time` (明確)。
- **前端 UI 组件 (Date Picker)**：可以使用 `selectedDate`, `selectedTime` 以區分這是「選擇中」的狀態，而非「已存」的資料。

## 4. 資料庫欄位 vs 前端變數 (Case Style)

**現狀問題**： PostgreSQL 習慣使用 `snake_case`，而 JavaScript/React 習慣使用 `camelCase`。目前在前端混用了這兩種風格。

- **例子**：
    - `store.min_lead_hours` (直接使用 DB 欄位名)
    - `store.open_time`
    - 但在某些 State 中又使用 `staffId`

**建議統一方案**：

- **原則**：前端接收來自 Supabase 的資料時，**直接沿用 DB 的 `snake_case`** (因為 Supabase SDK 回傳就是這樣，手動轉駝峰太累且耗效能)。
- **例外**：純前端的 React State (如 `isLoading`, `showModal`) 使用 `camelCase`。

## 5. 實體名稱統一 (Entity Naming)

| **概念** | **目前混用詞彙** | **建議統一詞彙** |
| --- | --- | --- |
| **課程/服務** | `Service`, `Course`, `Item` | **`Service`** (對應 DB `services`) |
| **員工/老師** | `Staff`, `Teacher` | **`Staff`** (對應 DB `staff`) |
| **店家/商戶** | `Store`, `Shop` | **`Store`** (對應 DB `stores`) |

## 下一步行動建議 (Action Plan)

若您同意上述建議，我們可以分階段進行重構：

1. **Phase 1 (低風險)**：統一 `index.html` 與 `staff.html` 中的 `login_code` 命名。
2. **Phase 2 (中風險)**：修改 URL 參數邏輯，將 `?id=` 遷移至 `?store_id=` 與 `?staff_id=` (需同步修改 QR Code 生成邏輯)。
3. **Phase 3 (高風險)**：雖然目前運作正常，但未來若要重構 DB，建議將 `bookings` 表的 `customer_name` 改為關聯 `customer_id` 的 View，減少資料冗餘。
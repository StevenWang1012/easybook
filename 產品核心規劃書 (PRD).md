EasyBook 預約系統 - 產品核心規劃書 (V3.11 Final)

1. 產品定位

EasyBook 是一套 「SaaS 多租戶預約管理系統」，專為個人工作室（物理治療、健身教練、美容美甲）設計。
核心價值在於解決 「預約排程混亂」、「營收統計困難」 與 「客戶關係疏離」 三大痛點，並透過三端分離架構（平台/商家/客戶）實現商業化營運。

2. 系統架構與角色

系統採用 三端分離 設計，共用同一套 Supabase 資料庫，透過 store_id 進行嚴格的租戶隔離。

角色

入口頁面

核心職責

權限特徵

平台總管 (SuperAdmin)

superadmin.html

開通商家、管理合約、監控全平台營收

上帝視角，可讀寫所有資料

商家店長 (Admin)

admin.html

課程/人員設定、排班管理、營收報表、客戶管理

僅限讀寫自己 store_id 的資料

老師/員工 (Staff)

staff.html

查看個人班表、核銷訂單、申請排休、推廣連結

需 Passcode 驗證，僅操作相關訂單

消費者 (Client)

booking.html

瀏覽課程、預約時段、查詢歷史紀錄

公開訪問，僅能寫入自己的預約

3. 核心功能模組 (Features)

3.1 商家後台 (Admin)

營收儀表板 (Dashboard)：

即時顯示今日/本月營收（含預估）、訂單數。

預約列表：整合客戶預約與人員排休，支援狀態篩選。

排休合併顯示：連續休假時段自動合併為單一卡片，介面清爽。

排班管理 (Schedule)：

月曆視圖：直觀顯示每日排休狀況，支援「全店公休」與「多人休假」標示。

衝突檢測 (Conflict Guard)：[關鍵優化] 設定休假前自動檢查該時段是否有「已確認」訂單，強制阻擋並提示先取消預約。

彈性排休：支援「全天」或「指定時段」休假，可針對「個人」或「全店」。

客戶管理 (CRM)：

消費力分析：自動計算客戶總消費額、完成次數，支援 VVIP 標籤。

進度備註：紀錄物理治療/服務進度，支援老師端同步查看。

黑名單機制：可封鎖惡意爽約客戶，阻擋其再次預約。

基礎設定：

商店資料：名稱、地址、營業時間。

預約須知 (Terms)：自訂取消政策與注意事項，支援一鍵帶入範本。

人員/課程管理：支援圖片上傳 (Supabase Storage)、價格與時長設定。

3.2 老師專區 (Staff Portal)

個人儀表板：顯示待執行、已完成、總人次統計。

行程管理：

查看個人班表（支援月曆/列表切換）。

訂單核銷：執行「完成課程」或「取消預約」。

代客預約 (Walk-in)：協助現場/電話客戶新增預約。

推廣工具：自動生成個人專屬預約連結與 QR Code。

3.3 客戶預約 (Client Booking)

流暢預約流程：選擇課程 -> 選擇老師 -> 選擇時段 -> 確認資料。

智慧時段計算：

自動過濾「已預約」與「排休」時段。

預約緩衝 (Lead Time)：依據店家設定，自動隱藏「太接近現在」的時段。

會員中心：

我的訂單：查詢歷史與未來行程。

LINE 整合：支援 LIFF 快速登入與加入官方帳號引導。

3.4 平台總管 (SaaS Master)

商家開通 (Provisioning)：一鍵建立商家帳號與資料庫紀錄，設定試用期/付費方案。

合約管理：查看商家到期日，支援「智慧續約」按鈕 (+30天/+1年)。

4. 技術架構與安全策略

4.1 資料庫設計

核心資料表：stores, staff, services, customers, bookings.

全部資料表強制包含 store_id 欄位，作為多租戶隔離依據。

4.2 權限控制 (Hybrid Auth)

讀取 (Read)：主要依賴 RLS (Row Level Security)。

規則：store_id = current_store_id (確保 A 店看不到 B 店資料)。

寫入 (Write)：全面採用 RPC (Remote Procedure Call)。

原因：繞過前端 RLS 對於複雜邏輯（如黑名單檢查、跨表驗證）的限制。

實作：所有新增/修改/刪除操作均透過 Security Definer 的 PostgreSQL 函數執行，確保資料完整性與安全性。

5. 商業化策略

目標客群：物理治療所、個人健身教練、美甲美睫工作室。

計費模式：訂閱制 (SaaS)。

月繳/年繳：透過 SuperAdmin 設定到期日控管。

功能分級：目前為全功能單一版本 (All-in-One)。

部署建議：前端 HTML 可部署於任何靜態空間 (GitHub Pages, Vercel)，後端依賴 Supabase 雲端服務。
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amber Flow - ÂïÜÂÆ∂ÁÆ°ÁêÜÂæåÂè∞</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ‚òÖ ÂÖ±Áî® Amber Flow ÁöÑË≥áÊñôÂ∫´ÈÄ£Á∑ö
        const supabaseUrl = 'https://kwvbhzjzysmivafsvwng.supabase.co';
        const supabaseKey = 'sb_publishable_7RUbenk2kXNDmvuo1XtHbQ_m0RjXuZr'; 
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        function AdminApp() {
            // ‚òÖ Êñ∞Â¢ûÔºöÁôªÂÖ•ÁãÄÊÖãÁÆ°ÁêÜ
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            
            const [bookings, setBookings] = useState([]);
            const [stats, setStats] = useState({ count: 0, revenue: 0 });
            const [loading, setLoading] = useState(false);

            // --- ËÆÄÂèñÈ†êÁ¥ÑË≥áÊñô (Âè™ÊúâÁôªÂÖ•ÂæåÊâçÂü∑Ë°å) ---
            useEffect(() => {
                if (isLoggedIn) {
                    fetchBookings();
                }
            }, [isLoggedIn]);

            async function fetchBookings() {
                try {
                    setLoading(true);
                    const { data, error } = await supabaseClient
                        .from('bookings')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    setBookings(data || []);
                    const totalRevenue = data.length * 1200; 
                    setStats({ count: data.length, revenue: totalRevenue });

                } catch (err) {
                    console.error("ËÆÄÂèñÂ§±Êïó:", err);
                } finally {
                    setLoading(false);
                }
            }

            const handleCopyLink = () => {
                const currentUrl = window.location.href;
                const bookingUrl = currentUrl.includes('admin.html') 
                    ? currentUrl.replace('admin.html', 'index.html')
                    : currentUrl.replace(/\/$/, '') + '/index.html';

                navigator.clipboard.writeText(bookingUrl).then(() => {
                    alert("‚úÖ ÈÄ£ÁµêÂ∑≤Ë§áË£ΩÔºÅ\n" + bookingUrl);
                }).catch(err => {
                    prompt("Ë´ãÊâãÂãïË§áË£Ω‰ª•‰∏ãÈÄ£ÁµêÔºö", bookingUrl);
                });
            };

            const Icon = ({ name, size = 20, className = "" }) => {
                const ref = useRef(null);
                useEffect(() => {
                    if (!ref.current || !window.lucide) return;
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    i.setAttribute('width', size);
                    i.setAttribute('height', size);
                    if (className) i.setAttribute('class', className);
                    ref.current.innerHTML = '';
                    ref.current.appendChild(i);
                    window.lucide.createIcons({ root: ref.current });
                }, [name, size, className]);
                return <span ref={ref} className="inline-flex items-center justify-center"></span>;
            };

            // ‚òÖ Áï´Èù¢ 1: Ê®°Êì¨ÁôªÂÖ•È†ÅÈù¢
            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-100 p-4">
                        <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm border border-slate-200">
                            <div className="flex justify-center mb-6">
                                <div className="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center">
                                    <span className="text-3xl">üßò‚Äç‚ôÄÔ∏è</span>
                                </div>
                            </div>
                            <h2 className="text-2xl font-bold text-center text-slate-800 mb-1">Amber Flow</h2>
                            <p className="text-center text-slate-500 text-sm mb-8">ÂïÜÂÆ∂ÁÆ°ÁêÜÁ≥ªÁµ±</p>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 mb-1 uppercase">Â∏≥Ëôü</label>
                                    <input type="text" value="admin" disabled className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-500 cursor-not-allowed font-mono" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-400 mb-1 uppercase">ÂØÜÁ¢º</label>
                                    <input type="password" value="1234" disabled className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-500 cursor-not-allowed font-mono" />
                                </div>
                                <button 
                                    onClick={() => setIsLoggedIn(true)}
                                    className="w-full bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-900 transition shadow-lg active:scale-95 flex items-center justify-center mt-4"
                                >
                                    ÁôªÂÖ•Á≥ªÁµ± <Icon name="arrow-right" size={16} className="ml-2" />
                                </button>
                            </div>
                            <p className="text-center text-xs text-slate-300 mt-6">Demo Version 1.0</p>
                        </div>
                    </div>
                );
            }

            // ‚òÖ Áï´Èù¢ 2: Ê≠£ÂºèÂÑÄË°®Êùø (Dashboard)
            return (
                <div className="min-h-screen flex">
                    {/* Â∑¶ÂÅ¥ÈÅ∏ÂñÆ (Sidebar) */}
                    <aside className="w-64 bg-slate-900 text-white hidden md:block">
                        <div className="p-6 border-b border-slate-700">
                            <h1 className="text-xl font-bold flex items-center">
                                <span className="mr-2">üßò‚Äç‚ôÄÔ∏è</span> Amber Flow
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">ÂïÜÂÆ∂ÁÆ°ÁêÜÂæåÂè∞</p>
                        </div>
                        <nav className="p-4 space-y-2">
                            <a href="#" className="flex items-center p-3 bg-emerald-600 rounded-lg text-white font-medium">
                                <Icon name="layout-dashboard" className="mr-3" /> ÂÑÄË°®Êùø
                            </a>
                            <a href="#" className="flex items-center p-3 text-slate-400 hover:bg-slate-800 hover:text-white rounded-lg transition">
                                <Icon name="calendar" className="mr-3" /> Ë°å‰∫ãÊõÜ
                            </a>
                            <a href="#" className="flex items-center p-3 text-slate-400 hover:bg-slate-800 hover:text-white rounded-lg transition">
                                <Icon name="users" className="mr-3" /> ÊúÉÂì°ÁÆ°ÁêÜ
                            </a>
                        </nav>
                        <div className="p-4 mt-auto border-t border-slate-800">
                             <button onClick={() => setIsLoggedIn(false)} className="flex items-center text-slate-400 hover:text-white text-sm">
                                 <Icon name="log-out" size={16} className="mr-2" /> ÁôªÂá∫
                             </button>
                        </div>
                    </aside>

                    {/* ‰∏ªË¶ÅÂÖßÂÆπÂçÄ */}
                    <main className="flex-1 overflow-y-auto">
                        <header className="bg-white border-b border-gray-200 p-4 md:p-6 flex justify-between items-center sticky top-0 z-10">
                            <div className="flex items-center md:hidden">
                                <Icon name="menu" className="mr-4" />
                                <span className="font-bold">Amber Flow</span>
                            </div>
                            <h2 className="text-xl font-bold text-slate-800 hidden md:block">‰ªäÊó•Ê¶ÇÊ≥Å</h2>
                            <div className="flex items-center space-x-4">
                                <button 
                                    onClick={handleCopyLink}
                                    className="hidden md:flex items-center bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-700 transition shadow-sm active:scale-95"
                                >
                                    <Icon name="link" size={16} className="mr-2" />
                                    Ë§áË£ΩÂ∫óÈã™ÈÄ£Áµê
                                </button>

                                <button className="p-2 bg-gray-100 rounded-full hover:bg-gray-200 relative">
                                    <Icon name="bell" size={20} />
                                    <span className="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span>
                                </button>
                                <div className="w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-700 font-bold text-xs border-2 border-white shadow-sm">
                                    AM
                                </div>
                            </div>
                        </header>

                        <div className="p-4 md:p-8 max-w-6xl mx-auto space-y-8">
                            
                            <div className="md:hidden">
                                <button 
                                    onClick={handleCopyLink}
                                    className="w-full flex justify-center items-center bg-slate-800 text-white px-4 py-3 rounded-xl text-sm font-bold hover:bg-slate-700 transition shadow-sm"
                                >
                                    <Icon name="link" size={16} className="mr-2" />
                                    Ë§áË£ΩÂ∫óÈã™È†êÁ¥ÑÈÄ£Áµê
                                </button>
                            </div>

                            {/* Êï∏ÊìöÂç°ÁâáÂçÄ */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <p className="text-sm text-slate-400 mb-1">‰ªäÊó•Ë®ÇÂñÆ</p>
                                            <h3 className="text-3xl font-bold text-slate-800">{stats.count}</h3>
                                        </div>
                                        <div className="p-3 bg-blue-50 text-blue-600 rounded-xl">
                                            <Icon name="ticket" />
                                        </div>
                                    </div>
                                    <div className="text-xs text-green-600 flex items-center font-bold">
                                        <Icon name="trending-up" size={14} className="mr-1" /> +12% ËºÉÊò®Êó•
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <p className="text-sm text-slate-400 mb-1">È†ê‰º∞ÁáüÊî∂</p>
                                            <h3 className="text-3xl font-bold text-slate-800">${stats.revenue.toLocaleString()}</h3>
                                        </div>
                                        <div className="p-3 bg-emerald-50 text-emerald-600 rounded-xl">
                                            <Icon name="dollar-sign" />
                                        </div>
                                    </div>
                                    <div className="text-xs text-slate-400">
                                        ÂåÖÂê´Êú™‰ªòÊ¨æË®ÇÂñÆ
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <p className="text-sm text-slate-400 mb-1">Êñ∞ÊúÉÂì°</p>
                                            <h3 className="text-3xl font-bold text-slate-800">3</h3>
                                        </div>
                                        <div className="p-3 bg-purple-50 text-purple-600 rounded-xl">
                                            <Icon name="user-plus" />
                                        </div>
                                    </div>
                                    <div className="text-xs text-green-600 flex items-center font-bold">
                                        <Icon name="trending-up" size={14} className="mr-1" /> ÊåÅÁ∫åÊàêÈï∑‰∏≠
                                    </div>
                                </div>
                            </div>

                            {/* Ë®ÇÂñÆÂàóË°®ÂçÄ */}
                            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                                <div className="p-6 border-b border-gray-100 flex justify-between items-center">
                                    <h3 className="font-bold text-lg text-slate-800">ÊúÄÊñ∞È†êÁ¥Ñ</h3>
                                    <button onClick={fetchBookings} className="text-sm text-emerald-600 hover:text-emerald-700 flex items-center font-bold">
                                        <Icon name="refresh-ccw" size={14} className="mr-1" /> ÈáçÊñ∞Êï¥ÁêÜ
                                    </button>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left border-collapse">
                                        <thead className="bg-gray-50 text-slate-500 text-xs uppercase">
                                            <tr>
                                                <th className="p-4 font-bold border-b border-gray-100">È°ßÂÆ¢ÂßìÂêç</th>
                                                <th className="p-4 font-bold border-b border-gray-100">È†êÁ¥ÑÈ†ÖÁõÆ</th>
                                                <th className="p-4 font-bold border-b border-gray-100">Êó•ÊúüÊôÇÈñì</th>
                                                <th className="p-4 font-bold border-b border-gray-100">ÊåáÂÆö‰∫∫Âì°</th>
                                                <th className="p-4 font-bold border-b border-gray-100">ÁãÄÊÖã</th>
                                            </tr>
                                        </thead>
                                        <tbody className="text-sm">
                                            {loading ? (
                                                <tr><td colSpan="5" className="p-8 text-center text-slate-400">ËºâÂÖ•‰∏≠...</td></tr>
                                            ) : bookings.length === 0 ? (
                                                <tr><td colSpan="5" className="p-8 text-center text-slate-400">ÁõÆÂâçÊ≤íÊúâÈ†êÁ¥ÑË≥áÊñô</td></tr>
                                            ) : (
                                                bookings.map(booking => (
                                                    <tr key={booking.id} className="hover:bg-gray-50 border-b border-gray-100 last:border-0 transition">
                                                        <td className="p-4">
                                                            <div className="font-bold text-slate-700">{booking.customer_name}</div>
                                                            <div className="text-xs text-slate-400">{booking.customer_phone}</div>
                                                        </td>
                                                        <td className="p-4 text-slate-600">{booking.service_name}</td>
                                                        <td className="p-4">
                                                            <div className="bg-slate-100 text-slate-600 px-2 py-1 rounded inline-block font-mono text-xs">
                                                                {booking.booking_date} {booking.booking_time}
                                                            </div>
                                                        </td>
                                                        <td className="p-4 text-slate-600">{booking.staff_name}</td>
                                                        <td className="p-4">
                                                            <span className="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-bold">
                                                                Â∑≤Á¢∫Ë™ç
                                                            </span>
                                                        </td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminApp />);
    </script>
</body>
</html>